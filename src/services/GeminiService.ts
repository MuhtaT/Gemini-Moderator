import axios from "axios";
import { AppConfig } from "../config";

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ Gemini API
export interface GeminiContent {
  parts: Array<{
    text?: string;
    inlineData?: {
      mimeType: string;
      data: string; // base64 encoded data
    };
  }>;
}

export interface GeminiRequestData {
  contents: GeminiContent[];
  generationConfig?: {
    temperature?: number;
    topP?: number;
    topK?: number;
    maxOutputTokens?: number;
    stopSequences?: string[];
  };
  safetySettings?: Array<{
    category: string;
    threshold: string;
  }>;
  tools?: Array<{
    functionDeclarations: FunctionDeclaration[];
  }>;
}

export interface GeminiStreamingData {
  candidates: Array<{
    content: {
      parts: Array<{
        text?: string;
        functionCall?: {
          name: string;
          args: Record<string, any>;
        };
      }>;
    };
    finishReason: string;
    safetyRatings: Array<{
      category: string;
      probability: string;
    }>;
    index: number;
  }>;
}

export interface FunctionDeclaration {
  name: string;
  description: string;
  parameters: {
    type: string;
    properties: Record<string, {
      type: string;
      description: string;
    }>;
    required?: string[];
  };
}

export interface ModerateMessageRequest {
  messageText: string;
  userName?: string;
  userBio?: string;
  hasAvatar?: boolean; // –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–ª–∏—á–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ –≤–º–µ—Å—Ç–æ –µ–µ –ø–µ—Ä–µ–¥–∞—á–∏
  suspiciousProfile?: boolean;
  suspicionReason?: string;
  messageId?: number; // –î–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –±–∞—Ç—á–µ
  chatId?: number; // –î–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–∞—Ç–∞
}

export interface ModerateMessageResponse {
  isSpam: boolean;
  confidence: number;
  reason: string;
  matchesKnownPattern: boolean;
  shouldBan: boolean;
  messageId?: number; // –î–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –≤ –±–∞—Ç—á–µ
}

// –ë–∞—Ç—á –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
export interface ModerationBatch {
  messages: ModerateMessageRequest[]; // –°–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–µ–∫—É—â–µ–º –±–∞—Ç—á–µ
  timer: NodeJS.Timeout | null; // –¢–∞–π–º–µ—Ä –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–∞—Ç—á–∞
  lastMessageTime: number; // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
}

export class GeminiService {
  private apiUrl: string;
  private apiKey: string;
  private model: string;
  private batchMap: Map<number, ModerationBatch> = new Map(); // –ú–∞–ø–∞ –¥–ª—è –±–∞—Ç—á–∏–Ω–≥–∞ –ø–æ chatId
  private batchTimeout: number;
  private maxBatchSize: number;

  constructor(
    config: AppConfig, 
    model = "gemini-2.0-flash", 
    batchTimeout = 3000, 
    maxBatchSize = 10
  ) {
    this.apiUrl = config.geminiApiUrl;
    this.apiKey = config.geminiApiKey;
    this.model = model;
    this.batchTimeout = batchTimeout;
    this.maxBatchSize = maxBatchSize;
    
    console.log(`GeminiService –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –º–æ–¥–µ–ª—å—é ${model}, —Ç–∞–π–º–∞—É—Ç–æ–º –±–∞—Ç—á–∞ ${batchTimeout}–º—Å, —Ä–∞–∑–º–µ—Ä–æ–º –±–∞—Ç—á–∞ ${maxBatchSize}`);
  }

  /**
   * –ë–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å Gemini API
   */
  async generateContent(
    prompt: string,
    options: {
      temperature?: number;
      maxOutputTokens?: number;
      tools?: Array<{ functionDeclarations: FunctionDeclaration[] }>;
    } = {}
  ): Promise<string> {
    try {
      const requestData: GeminiRequestData = {
        contents: [
          {
            parts: [
              {
                text: prompt,
              },
            ],
          },
        ],
        generationConfig: {
          temperature: options.temperature || 0.2,
          maxOutputTokens: options.maxOutputTokens || 1024,
        },
      };

      if (options.tools) {
        requestData.tools = options.tools;
      }

      const response = await axios.post(
        `${this.apiUrl}/models/${this.model}:generateContent?key=${this.apiKey}`,
        requestData
      );

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –æ—Ç–≤–µ—Ç–µ
      if (
        response.data.candidates &&
        response.data.candidates[0].content?.parts?.[0]?.functionCall
      ) {
        const functionCall = response.data.candidates[0].content.parts[0].functionCall;
        return JSON.stringify(functionCall);
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ –æ—Ç–≤–µ—Ç–µ
      if (
        response.data.candidates &&
        response.data.candidates[0].content?.parts?.[0]?.text
      ) {
        return response.data.candidates[0].content.parts[0].text;
      }

      throw new Error("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Gemini API");
    } catch (error) {
      if (axios.isAxiosError(error) && error.response) {
        console.error("–û—à–∏–±–∫–∞ API Gemini:", error.response.status, error.response.data);
      } else {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ Gemini API:", error);
      }
      throw error;
    }
  }

  /**
   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –ø–æ—Ç–æ–∫–æ–≤—ã–º –æ—Ç–≤–µ—Ç–æ–º
   */
  async *generateContentStream(
    prompt: string,
    options: {
      temperature?: number;
      maxOutputTokens?: number;
      tools?: Array<{ functionDeclarations: FunctionDeclaration[] }>;
    } = {}
  ): AsyncGenerator<string, void, unknown> {
    try {
      const requestData: GeminiRequestData = {
        contents: [
          {
            parts: [
              {
                text: prompt,
              },
            ],
          },
        ],
        generationConfig: {
          temperature: options.temperature || 0.2,
          maxOutputTokens: options.maxOutputTokens || 1024,
        },
      };

      if (options.tools) {
        requestData.tools = options.tools;
      }

      const response = await axios.post(
        `${this.apiUrl}/models/${this.model}:streamGenerateContent?key=${this.apiKey}`,
        requestData,
        {
          responseType: "stream",
        }
      );

      let buffer = "";
      for await (const chunk of response.data) {
        const chunkStr = chunk.toString();
        buffer += chunkStr;

        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏
        const lines = buffer.split("\n");
        buffer = lines.pop() || ""; // –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω–æ–π

        for (const line of lines) {
          if (line.trim() === "") continue;
          if (line.startsWith("data: ")) {
            const dataStr = line.slice(6);
            if (dataStr === "[DONE]") {
              return;
            }

            try {
              const data: GeminiStreamingData = JSON.parse(dataStr);
              if (
                data.candidates &&
                data.candidates[0].content?.parts?.[0]?.text
              ) {
                yield data.candidates[0].content.parts[0].text;
              } else if (
                data.candidates &&
                data.candidates[0].content?.parts?.[0]?.functionCall
              ) {
                yield JSON.stringify(
                  data.candidates[0].content.parts[0].functionCall
                );
              }
            } catch (e) {
              console.error("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç—Ä–æ–∫–∏ –ø–æ—Ç–æ–∫–∞:", e);
            }
          }
        }
      }
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –≤ –ø–æ—Ç–æ–∫–æ–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:", error);
      throw error;
    }
  }

  /**
   * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏
   * –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –º–æ–¥–µ–ª—å –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON
   */
  private extractModerationFromText(text: string): ModerateMessageResponse {
    try {
      console.log("–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞:", text.substring(0, 200) + "...");
      
      // –ö–û–ú–ú–ï–ù–¢–ò–†–£–ï–ú –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –º–∞—Ç–æ–º
      // –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–æ–ª–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
      // const toxicPatterns = [
      //   /–º–∞—Ç/i, /–æ—Å–∫–æ—Ä–±–ª–µ–Ω/i, /—Ç–æ–∫—Å–∏—á–Ω/i, /—Å–≤–æ–±–æ–¥[–∞-—è]+ —Å–ª–æ–≤/i, 
      //   /–Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–ø–∞–º–æ–º/i, /–Ω–µ —Å–ø–∞–º/i, /–ª–µ–≥–∏—Ç–∏–º–Ω/i
      // ];
      
      // if (toxicPatterns.some(pattern => pattern.test(text))) {
      //   console.log("–¢–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –º–∞—Ç–µ/–æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è—Ö, —Å—á–∏—Ç–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º");
      //   return {
      //     isSpam: false,
      //     confidence: 0.9,
      //     reason: "–õ–µ–≥–∏—Ç–∏–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–∫—Å–∏—á–Ω–æ–µ, –Ω–æ —ç—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)",
      //     matchesKnownPattern: false,
      //     shouldBan: false
      //   };
      // }
      
      // –ö–û–ú–ú–ï–ù–¢–ò–†–£–ï–ú –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º $GOVNO –∏ Overbafer1
      // –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–æ–ª–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
      // if (text.toLowerCase().includes("$govno") || 
      //     text.toLowerCase().includes("overbafer1") || 
      //     text.toLowerCase().includes("–Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–ø–∞–º–æ–º")) {
      //   // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç —É–ø–æ–º–∏–Ω–∞–µ—Ç –ª–µ–≥–∏—Ç–∏–º–Ω—ã–µ —Ç–µ–º—ã —á–∞—Ç–∞ –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —è–≤–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å–ø–∞–º–∞
      //   if (!text.toLowerCase().includes("—Å–ø–∞–º") || 
      //       text.toLowerCase().includes("–Ω–µ —Å–ø–∞–º") ||
      //       text.toLowerCase().includes("–Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–ø–∞–º–æ–º")) {
      //     return {
      //       isSpam: false,
      //       confidence: 0.9,
      //       reason: "–õ–µ–≥–∏—Ç–∏–º–Ω–æ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —Ç–µ–º —á–∞—Ç–∞ ($GOVNO, Overbafer1)",
      //       matchesKnownPattern: false,
      //       shouldBan: false
      //     };
      //   }
      // }
      
      // –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ JSON –≤ –æ—Ç–≤–µ—Ç–µ (–µ—Å–ª–∏ –º–æ–¥–µ–ª—å –≤—ã–≤–µ–ª–∞ JSON –≤ –æ–±—ã—á–Ω–æ–º —Ç–µ–∫—Å—Ç–µ)
      const jsonMatch = text.match(/\{[\s\S]*?\}/);
      if (jsonMatch) {
        try {
          const jsonData = JSON.parse(jsonMatch[0]);
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ JSON —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
          if (jsonData.isSpam !== undefined && jsonData.confidence !== undefined) {
            console.log("–ù–∞–π–¥–µ–Ω JSON –≤ —Ç–µ–∫—Å—Ç–µ –æ—Ç–≤–µ—Ç–∞:", jsonData);
            return {
              isSpam: Boolean(jsonData.isSpam),
              confidence: Number(jsonData.confidence),
              reason: jsonData.reason || "–ò–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ JSON –≤ —Ç–µ–∫—Å—Ç–µ",
              matchesKnownPattern: Boolean(jsonData.matchesKnownPattern),
              shouldBan: Boolean(jsonData.shouldBan)
            };
          }
        } catch (e) {
          console.warn("–ù–∞–π–¥–µ–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç –ø–æ—Ö–æ–∂–∏–π –Ω–∞ JSON, –Ω–æ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è:", e);
        }
      }
      
      // –ï—Å–ª–∏ JSON –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—â–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ —Ç–µ–∫—Å—Ç–µ
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ø–∞–º–æ–º
      // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º —è–≤–Ω—ã–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ —Å–ø–∞–º–µ
      let isSpam = false;
      if (/–Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–ø–∞–º–æ–º|–Ω–µ —Å–ø–∞–º|–Ω–µ —Ä–µ–∫–ª–∞–ºa/i.test(text)) {
        isSpam = false;
      } else if (/—è–≤–ª—è–µ—Ç—Å—è —Å–ø–∞–º–æ–º|—ç—Ç–æ —Å–ø–∞–º|—ç—Ç–æ —Ä–µ–∫–ª–∞–º–∞/i.test(text)) {
        isSpam = true;
      } else {
        // –ò–Ω–∞—á–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        isSpam = /—Å–ø–∞–º|—Ä–µ–∫–ª–∞–º|–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω|–≤—Ä–µ–¥–æ–Ω–æ—Å–Ω/i.test(text);
      }
      
      // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ç–µ–∫—Å—Ç–µ (—á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 1 –∏–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã)
      let confidence = 0;
      const confidenceMatch = text.match(/—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:?\s*([\d.]+)%?/i) || 
                              text.match(/confidence:?\s*([\d.]+)%?/i) ||
                              text.match(/—Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é\s*([\d.]+)%?/i);
      if (confidenceMatch) {
        confidence = parseFloat(confidenceMatch[1]);
        // –ï—Å–ª–∏ —á–∏—Å–ª–æ –±–æ–ª—å—à–µ 1, —Ç–æ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —ç—Ç–æ –ø—Ä–æ—Ü–µ–Ω—Ç—ã
        if (confidence > 1) confidence = confidence / 100;
      } else {
        // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Å–ª–æ–≤–µ—Å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
        if (/–≤—ã—Å–æ–∫[–∞-—è]+ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç|—Å –≤—ã—Å–æ–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é/i.test(text)) {
          confidence = 0.9;
        } else if (/—Å—Ä–µ–¥–Ω[–∞-—è]+ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç/i.test(text)) {
          confidence = 0.7;
        } else if (/–Ω–∏–∑–∫[–∞-—è]+ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç/i.test(text)) {
          confidence = 0.3;
        } else {
          // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É–º–µ—Ä–µ–Ω–Ω—É—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
          confidence = isSpam ? 0.75 : 0.25;
        }
      }
      
      // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É
      let reason = "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –ø—Ä–∏—á–∏–Ω—É –∏–∑ –æ—Ç–≤–µ—Ç–∞";
      const reasonPatterns = [
        /–ø—Ä–∏—á–∏–Ω–∞:?\s*([^\n.]+)[.\n]/i,
        /reason:?\s*([^\n.]+)[.\n]/i,
        /–ø–æ—Ç–æ–º—É —á—Ç–æ\s*([^\n.]+)[.\n]/i,
        /–ø–æ—Å–∫–æ–ª—å–∫—É\s*([^\n.]+)[.\n]/i,
        /—Ç–∞–∫ –∫–∞–∫\s*([^\n.]+)[.\n]/i
      ];
      
      for (const pattern of reasonPatterns) {
        const match = text.match(pattern);
        if (match) {
          reason = match[1].trim();
          break;
        }
      }
      
      if (reason === "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –ø—Ä–∏—á–∏–Ω—É –∏–∑ –æ—Ç–≤–µ—Ç–∞" && isSpam) {
        // –ï—Å–ª–∏ —ç—Ç–æ —Å–ø–∞–º, –Ω–æ –ø—Ä–∏—á–∏–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —á–∞—Å—Ç—å —Ç–µ–∫—Å—Ç–∞
        const sentences = text.split(/[.!?]+/);
        for (const sentence of sentences) {
          if (sentence.toLowerCase().includes("—Å–ø–∞–º") || 
              sentence.toLowerCase().includes("—Ä–µ–∫–ª–∞–º") ||
              sentence.toLowerCase().includes("–ø–æ–¥–æ–∑—Ä–∏—Ç")) {
            reason = sentence.trim();
            break;
          }
        }
      }
      
      // –ü—ã—Ç–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —Å—Ç–æ–∏—Ç –ª–∏ –±–∞–Ω–∏—Ç—å
      const shouldBan = /—Å–ª–µ–¥—É–µ—Ç –∑–∞–±–∞–Ω–∏—Ç—å|–Ω—É–∂–Ω–æ –∑–∞–±–∞–Ω–∏—Ç—å|—Ä–µ–∫–æ–º–µ–Ω–¥[–∞-—è]+ –±–∞–Ω|–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/i.test(text) ||
                        /–±–∞–Ω|ban|–±–ª–æ–∫–∏—Ä|–∑–∞–±–ª–æ–∫–∏—Ä/i.test(text);
      
      // –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ–º—É —à–∞–±–ª–æ–Ω—É
      const matchesKnownPattern = /—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤[–∞-—è]+ –∏–∑–≤–µ—Å—Ç–Ω|–∏–∑–≤–µ—Å—Ç–Ω[–∞-—è]+ —à–∞–±–ª–æ–Ω|–ø–∞—Ç—Ç–µ—Ä–Ω|pattern/i.test(text) ||
                                  /–ø–æ—Ö–æ–∂[–∞-—è]+ –Ω–∞ —à–∞–±–ª–æ–Ω|—Ç–∏–ø–∏—á–Ω[–∞-—è]+ —à–ª—é—Ö–æ–±–æ—Ç|—Ç–∏–ø–∏—á–Ω[–∞-—è]+ —Å–ø–∞–º/i.test(text);
      
      console.log(`–ò–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ —Ç–µ–∫—Å—Ç–∞: isSpam=${isSpam}, confidence=${confidence}, shouldBan=${shouldBan}`);
      
      return {
        isSpam,
        confidence: confidence,
        reason,
        matchesKnownPattern: matchesKnownPattern || isSpam,
        shouldBan
      };
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞:", error);
      return {
        isSpam: false,
        confidence: 0,
        reason: "–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª–∏",
        matchesKnownPattern: false,
        shouldBan: false
      };
    }
  }

  /**
   * –î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –±–∞—Ç—á –∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –µ–≥–æ –æ—Ç–ø—Ä–∞–≤–∫—É
   */
  async queueMessageForModeration(
    request: ModerateMessageRequest
  ): Promise<Promise<ModerateMessageResponse>> {
    // –ï—Å–ª–∏ chatId –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const chatId = request.chatId || 0;
    
    return new Promise((resolve, reject) => {
      let batch = this.batchMap.get(chatId);
      
      // –ï—Å–ª–∏ –±–∞—Ç—á–∞ –¥–ª—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞ –µ—â–µ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
      if (!batch) {
        batch = {
          messages: [],
          timer: null,
          lastMessageTime: Date.now()
        };
        this.batchMap.set(chatId, batch);
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –±–∞—Ç—á
      batch.messages.push({
        ...request,
        messageId: request.messageId || batch.messages.length // –ï—Å–ª–∏ ID –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–¥–µ–∫—Å
      });
      batch.lastMessageTime = Date.now();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–±—ç–∫ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
      const messageIndex = batch.messages.length - 1;
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
      const handleResult = (results: ModerateMessageResponse[]) => {
        if (messageIndex < results.length) {
          resolve(results[messageIndex]);
        } else {
          reject(new Error("–ù–µ –Ω–∞–π–¥–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è"));
        }
      };
      
      // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –±–∞—Ç—á–µ, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
      if (batch.messages.length === 1) {
        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
        if (batch.timer) {
          clearTimeout(batch.timer);
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä
        batch.timer = setTimeout(async () => {
          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º –±–∞—Ç—á
          const messagesToProcess = [...batch.messages];
          this.batchMap.delete(chatId);
          
          try {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–∞—Ç—á –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
            const results = await this.moderateMessageBatch(messagesToProcess);
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —ç—Ç–æ–º –±–∞—Ç—á–µ
            for (let i = 0; i < messagesToProcess.length; i++) {
              handleResult(results);
            }
          } catch (error) {
            reject(error);
          }
        }, this.batchTimeout);
      } else if (batch.messages.length >= this.maxBatchSize) {
        // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –±–∞—Ç—á–∞, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ä–∞–∑—É
        if (batch.timer) {
          clearTimeout(batch.timer);
          batch.timer = null;
        }
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º –±–∞—Ç—á
        const messagesToProcess = [...batch.messages];
        this.batchMap.delete(chatId);
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–∞—Ç—á –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
        this.moderateMessageBatch(messagesToProcess)
          .then(results => handleResult(results))
          .catch(error => reject(error));
      }
    });
  }

  /**
   * –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   */
  private async moderateMessageBatch(
    messages: ModerateMessageRequest[]
  ): Promise<ModerateMessageResponse[]> {
    if (messages.length === 0) {
      return [];
    }
    
    if (messages.length === 1) {
      // –ï—Å–ª–∏ –≤ –±–∞—Ç—á–µ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—É—é –º–æ–¥–µ—Ä–∞—Ü–∏—é
      const result = await this.moderateMessage(messages[0]);
      return [result];
    }
    
    try {
      // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
      let prompt = `–¢—ã - –º–æ–¥–µ—Ä–∞—Ç–æ—Ä —á–∞—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¢–û–õ–¨–ö–û —Å–ø–∞–º-—Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —à–ª—é—Ö–æ–±–æ—Ç–æ–≤.
      
–í–ê–ñ–ù–û: –¢–´ –î–û–õ–ñ–ï–ù –û–¢–í–ï–ß–ê–¢–¨ –¢–û–õ–¨–ö–û –ß–ï–†–ï–ó –í–´–ó–û–í –§–£–ù–ö–¶–ò–ò moderate_messages_batch. –ù–ï –ü–ò–®–ò –¢–ï–ö–°–¢–û–í–´–ô –û–¢–í–ï–¢.
–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ò–°–ü–û–õ–¨–ó–£–ô –¢–û–õ–¨–ö–û FUNCTION CALLING API, –ê –ù–ï –¢–ï–ö–°–¢–û–í–´–ô –û–¢–í–ï–¢.
–¢–´ –ù–ï –ú–û–ñ–ï–®–¨ –û–¢–í–ï–¢–ò–¢–¨ –û–ë–´–ß–ù–´–ú –¢–ï–ö–°–¢–û–ú. –¢–û–õ–¨–ö–û –í–´–ó–û–í–û–ú –§–£–ù–ö–¶–ò–ò.

–ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –æ–ø—Ä–µ–¥–µ–ª–∏, –∫–∞–∫–∏–µ –∏–∑ –Ω–∏—Ö —è–≤–ª—è—é—Ç—Å—è —Å–ø–∞–º–æ–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–æ–π. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é moderate_messages_batch –¥–ª—è –æ—Ç–≤–µ—Ç–∞.

–í–ê–ñ–ù–´–ô –ö–û–ù–¢–ï–ö–°–¢: –≠—Ç–æ—Ç —á–∞—Ç –ø–æ—Å–≤—è—â–µ–Ω –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–º—É –º–µ–º–∫–æ–∏–Ω—É $GOVNO –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ TON, —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É –ø–æ–ø—É–ª—è—Ä–Ω—ã–º YouTube-–±–ª–æ–≥–µ—Ä–æ–º Overbafer1 (–ò–≥–æ—Ä—å –ü.). –£–ø–æ–º–∏–Ω–∞–Ω–∏—è $GOVNO, Overbafer1, TON, –∞ —Ç–∞–∫–∂–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –º–µ–º–∫–æ–∏–Ω–∞ –∏ –µ–≥–æ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –ù–ï —è–≤–ª—è—é—Ç—Å—è —Å–ø–∞–º–æ–º, –∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏ –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –≤ –¥–∞–Ω–Ω–æ–º —á–∞—Ç–µ.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û–ï –ü–†–ê–í–ò–õ–û: –£–î–ê–õ–Ø–¢–¨ –¢–û–õ–¨–ö–û –†–ï–ö–õ–ê–ú–£ –ò –®–õ–Æ–•–û–ë–û–¢–û–í. –õ—é–±–æ–π –¥—Ä—É–≥–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω —Å—Ç—Ä–∞–Ω–Ω—ã–π, –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π, —Ç–æ–∫—Å–∏—á–Ω—ã–π, –æ—Å–∫–æ—Ä–±–∏—Ç–µ–ª—å–Ω—ã–π –∏–ª–∏ –Ω–µ—É–º–µ—Å—Ç–Ω—ã–π. –ù–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∏ –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å —Ç–µ–º–∞—Ç–∏–∫–æ–π —á–∞—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç –ù–ï —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏—á–∏–Ω–æ–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è. –¢–µ–∫—Å—Ç—ã –ø–µ—Å–µ–Ω, –º–µ–º—ã, —Å—Ç—Ä–∞–Ω–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è, —Å–ª—É—á–∞–π–Ω—ã–µ —Ñ—Ä–∞–∑—ã, —à—É—Ç–∫–∏ - –í–°–ï —ç—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ. –ù–∞–∫–∞–∑—ã–≤–∞—Ç—å –¢–û–õ–¨–ö–û –∑–∞ —Ä–µ–∫–ª–∞–º—É –∏ —Å–ø–∞–º.

–í–ù–ò–ú–ê–ù–ò–ï –ü–û –ü–†–ò–í–ï–¢–°–¢–í–ï–ù–ù–´–ú –°–û–û–ë–©–ï–ù–ò–Ø–ú: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –ø–∏—à–µ—Ç "–ø—Ä–∏–≤–µ—Ç", "—Ö–∞–π", "–∑–¥–∞—Ä–æ–≤–∞" –∏–ª–∏ –¥—Ä—É–≥–æ–µ –∫–æ—Ä–æ—Ç–∫–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –∏ –ø—Ä–∏ —ç—Ç–æ–º –≤ –µ–≥–æ –ø—Ä–æ—Ñ–∏–ª–µ/–±–∏–æ –ù–ï–¢ –°–°–´–õ–û–ö –Ω–∞ –∫–∞–Ω–∞–ª—ã, —Å–∞–π—Ç—ã –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - —ç—Ç–æ –ù–ï —à–ª—é—Ö–æ–±–æ—Ç –∏ –ù–ï —Å–ø–∞–º. –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –±–µ–∑ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –≤ –±–∏–æ - –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ!

–í–ê–ñ–ù–û –û –ë–ò–û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô: –¢–µ–±–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ü–û–õ–ù–û–ï –∏ –ù–ï–ò–ó–ú–ï–ù–ï–ù–ù–û–ï –±–∏–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ –≤ –±–∏–æ –Ω–∞–ø–∏—Å–∞–Ω–æ "–°–ª–∞–≤–∞ $GOVNO üí© –°–ª–∞–≤–∞ overbafer1" –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Ç–µ–∫—Å—Ç, –∑–Ω–∞—á–∏—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç–æ —Ç–∞–º –∏ –Ω–∞–ø–∏—Å–∞–Ω–æ, –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ —Å–∫—Ä—ã—Ç—ã—Ö —Å—Å—ã–ª–æ–∫. –ù–ï –ü–†–ò–î–£–ú–´–í–ê–ô –Ω–∞–ª–∏—á–∏–µ —Å—Å—ã–ª–æ–∫, –µ—Å–ª–∏ –æ–Ω–∏ —è–≤–Ω–æ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –≤ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–º –±–∏–æ!

–û–°–û–ë–ï–ù–ù–û–°–¢–¨ –ß–ê–¢–ê: –≠—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ–µ –∫–æ–º—å—é–Ω–∏—Ç–∏ —Å —Ç–æ–∫—Å–∏—á–Ω–æ–π –∫—É–ª—å—Ç—É—Ä–æ–π. –ú–∞—Ç, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è, —É–≥—Ä–æ–∑—ã –∏ –ª—é–±–æ–π —Ç–æ–∫—Å–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ù–ï —Å—á–∏—Ç–∞—é—Ç—Å—è —Å–ø–∞–º–æ–º –∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–∑—Ä–µ—à–∞—Ç—å—Å—è. –ú–æ–¥–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —É–¥–∞–ª—è—Ç—å –¢–û–õ–¨–ö–û —Å–ø–∞–º-—Å–æ–æ–±—â–µ–Ω–∏—è –∏ —à–ª—é—Ö–æ–±–æ—Ç–æ–≤, –Ω–æ –ù–ï –¥–æ–ª–∂–Ω–∞ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—Ç—å —Å–≤–æ–±–æ–¥—É —Å–ª–æ–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞.

–†–ê–°–ü–û–ó–ù–ê–í–ê–ù–ò–ï –ò–†–û–ù–ò–ò –ò –®–£–¢–û–ö: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —à—É—Ç–∫—É –ø–∏—à–µ—Ç "—è —à–ª—é—Ö–æ–±–æ—Ç", "—è —Å–ø–∞–º–µ—Ä" –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–µ —Ñ—Ä–∞–∑—ã —Å –æ—á–µ–≤–∏–¥–Ω—ã–º –∏—Ä–æ–Ω–∏—á–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º - —ç—Ç–æ –ù–ï —Å–ø–∞–º, –∞ —à—É—Ç–∫–∞. –û–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–π —Å —à–∞–±–ª–æ–Ω–∞–º–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–ø–∞–º–∞. –ò—Ä–æ–Ω–∏—è –∏ —Å–∞–º–æ–∏—Ä–æ–Ω–∏—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤ —ç—Ç–æ–º —á–∞—Ç–µ.

–í–ê–ñ–ù–û –û –ú–ê–¢–ï –ò –¢–û–ö–°–ò–ß–ù–û–°–¢–ò: –ù–∞–ª–∏—á–∏–µ –º–∞—Ç–∞, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π –∏–ª–∏ —Å–ª–æ–≤–∞ "–≥–æ–≤–Ω–æ" –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –ù–ï –Ø–í–õ–Ø–ï–¢–°–Ø –ø—Ä–∏—á–∏–Ω–æ–π –¥–ª—è –µ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è. –°–ø–∞–º–µ—Ä—ã –∏ —à–ª—é—Ö–æ–±–æ—Ç—ã –º–æ–≥—É—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –º–∞—Ç –∏–ª–∏ —Å–ª–æ–≤–æ "–≥–æ–≤–Ω–æ" –≤ —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ–±—Ö–æ–¥–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—è–π –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å–ø–∞–º–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –Ω–∞–ª–∏—á–∏—è –≤ –Ω–∏—Ö –º–∞—Ç–∞ –∏–ª–∏ —Ç–æ–∫—Å–∏—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

–í–ê–ñ–ù–û –û–ë –£–ü–û–ú–ò–ù–ê–ù–ò–ò $GOVNO: –°–æ–æ–±—â–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —Å–ª–æ–≤–∞ "–≥–æ–≤–Ω–æ", "$GOVNO", "govno", "Overbafer1" –∏–ª–∏ "–æ–≤–µ—Ä–±–∞—Ñ–µ—Ä", –ù–ï —è–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–µ–≥–∏—Ç–∏–º–Ω—ã–º–∏ –∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Ç–∞–∫—É—é –∂–µ —Ç—â–∞—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Å–ø–∞–º, –∫–∞–∫ –∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –°–ø–∞–º–µ—Ä—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ —Å–ª–æ–≤–∞ –¥–ª—è –æ–±—Ö–æ–¥–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏. –ü—Ä–∏ —ç—Ç–æ–º —Å–∞–º–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ $GOVNO –Ω–µ –¥–æ–ª–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å—Å—è —Å–ø–∞–º–æ–º.

–†–ê–ó–†–ï–®–ï–ù–ù–´–ô –ö–û–ù–¢–ï–ù–¢ (–ù–ï –£–î–ê–õ–Ø–¢–¨):
- –ê–±—Å–æ–ª—é—Ç–Ω–æ –ª—é–±—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –ù–ï —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —Ä–µ–∫–ª–∞–º—É –∏–ª–∏ —Å–ø–∞–º
- –õ—é–±–æ–π –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å —Ç–µ–º–∞—Ç–∏–∫–æ–π —á–∞—Ç–∞
- –¢–µ–∫—Å—Ç—ã –ø–µ—Å–µ–Ω, —Å—Ç–∏—Ö–∏, —Ü–∏—Ç–∞—Ç—ã, –º–µ–º—ã
- –°–ª—É—á–∞–π–Ω—ã–µ —Ñ—Ä–∞–∑—ã –∏ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –õ—é–±—ã–µ –Ω–µ—É–º–µ—Å—Ç–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Ä–µ–∫–ª–∞–º–∞
- –ö–æ–Ω—Ç–µ–Ω—Ç 18+, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —á–∞—Å—Ç—å —Å–ø–∞–º-—Å–æ–æ–±—â–µ–Ω–∏—è

Overbafer1 - —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –±–ª–æ–≥–µ—Ä —Å –±–æ–ª–µ–µ —á–µ–º 1 –º–ª–Ω –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–∞ YouTube, –∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–≤–æ–∏–º–∏ –≤–∏–¥–µ–æ –æ–± –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö. –û–Ω –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ–º–∫–æ–∏–Ω–∞ $GOVNO, –∫–æ—Ç–æ—Ä—ã–π –¥–æ—Å—Ç–∏–≥ —Ä—ã–Ω–æ—á–Ω–æ–π –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ $70 –º–ª–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —á–∞—Ç–µ –º–æ–≥—É—Ç –æ–±—Å—É–∂–¥–∞—Ç—å $GOVNO, –µ–≥–æ —Ü–µ–Ω—É, —Ç–æ—Ä–≥–æ–≤–ª—é –Ω–∞ –±–∏—Ä–∂–∞—Ö DeDust –∏ STON.fi, –º–µ–º—ã —Å –Ω–∏–º –∏ –ø—Ä–æ—á–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã.

–í–æ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:\n\n`;
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º
      for (let i = 0; i < messages.length; i++) {
        const msg = messages[i];
        prompt += `–°–æ–æ–±—â–µ–Ω–∏–µ ${i + 1}:\n`;
        prompt += `–¢–µ–∫—Å—Ç: "${msg.messageText}"\n`;
        
        if (msg.userName) {
          prompt += `–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${msg.userName}\n`;
        }
        
        if (msg.userBio) {
          prompt += `–ë–∏–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${msg.userBio}\n`;
        }
        
        if (msg.hasAvatar !== undefined) {
          prompt += `–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${msg.hasAvatar ? "–µ—Å—Ç—å" : "–Ω–µ—Ç"} –∞–≤–∞—Ç–∞—Ä–∫–∞\n`;
        }
        
        if (msg.suspiciousProfile) {
          prompt += `–í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä–æ—Ñ–∏–ª—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π. –ü—Ä–∏—á–∏–Ω–∞: ${msg.suspicionReason || "–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –±–∏–æ —Å —Å—Å—ã–ª–∫–∞–º–∏"}\n`;
        }
        
        // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
        prompt += `---\n`;
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–∏—á–Ω—ã—Ö —à–∞–±–ª–æ–Ω–∞—Ö —Å–ø–∞–º–∞
      prompt += `
–ö–†–ò–¢–ï–†–ò–ò –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –°–ü–ê–ú–ê:

1. –¢–∏–ø–∏—á–Ω—ã–µ —à–ª—é—Ö–æ–±–æ—Ç—ã —á–∞—Å—Ç–æ –ø–∏—à—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞:
"–ü–æ–ª—É—á–∞–π —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥ –æ—Ç 100 –¥–æ–ª–ª–∞—Ä–æ–≤ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –±–µ–∑ –∫–∞–∫–æ–≥–æ-–ª–∏–±–æ —Ä–∏—Å–∫–∞. –û–ø—ã—Ç –Ω–µ –≤–∞–∂–µ–Ω. –í—Å–µ –¥–µ—Ç–∞–ª–∏ –º–æ–∂–µ—Ç–µ —É–∑–Ω–∞—Ç—å –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö"
"–•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –∫–∞–∫ —è –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—é? –ü–∏—à–∏ –º–Ω–µ"
"–ú–æ–≥—É –Ω–∞—É—á–∏—Ç—å –∫–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥, –ø–∏—à–∏ –≤ –ª–∏—á–∫—É"

2. –°–ö–†–´–¢–´–ï –ù–ê–ñ–ò–í–ö–ò –û–¢ –®–õ–Æ–•–û–ë–û–¢–û–í - –∫–æ—Ä–æ—Ç–∫–∏–µ –±–µ–∑–æ–±–∏–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, —Ü–µ–ª—å –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å:
"–ü—Ä–∏–≤–µ—Ç"
"–Ø –∫—Ä–∞—Å–∏–≤–∞—è?"
"–û, –∫—Ä—É—Ç–æ"
"–î–∞, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ç–∞–∫"
"–°–æ–≥–ª–∞—Å–Ω–∞"
"–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ"
"–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º, —è –Ω–æ–≤–µ–Ω—å–∫–∞—è"
"–ß—Ç–æ —Ç—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?"

–¢–∞–∫–∏–µ –±–µ–∑–æ–±–∏–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º (–∂–µ–Ω—Å–∫–æ–µ –∏–º—è + —Å—Å—ã–ª–∫–∞ –≤ –±–∏–æ) –¥–æ–ª–∂–Ω—ã —Å—á–∏—Ç–∞—Ç—å—Å—è —Å–ø–∞–º–æ–º!

3. –†–µ–∫–ª–∞–º—â–∏–∫–∏ –∫—Ä–∏–ø—Ç–æ-—É—Å–ª—É–≥ —á–∞—Å—Ç–æ –ø–∏—à—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞:
"–ù–∞–±–∏—Ä–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –∫—Ä–∏–ø—Ç–æ-—Å—Ñ–µ—Ä–µ"
"–°–∫–∏–¥—ã–≤–∞–µ–º —Ä–∞–±–æ—á—É—é —Å–≤—è–∑–∫—É ‚Äî –≤—ã –ø–ª–∞—Ç–∏—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π % —Å –≤–∞—à–µ–≥–æ –¥–æ—Ö–æ–¥–∞"
"–†–∞–±–æ—Ç–∞ —Å —Ç–∞–∫–∏–º–∏ –±–∏—Ä–∂–∞–º–∏, –∫–∞–∫: Bybit, Okx, Bitget, KuCoin, Mexc"
"–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –¥–æ 500$ –≤ —Å—É—Ç–∫–∏"
"–í—Å–µ–º—É –Ω–∞—É—á–∏–º –±–µ—Å–ø–ª–∞—Ç–Ω–æ"
"–ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏: @username"

–ò–ù–î–ò–ö–ê–¢–û–†–´ –°–ü–ê–ú–ê:

–°–ø–∞–º-—Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Å—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç:
- –û–±–µ—â–∞–Ω–∏—è –ª–µ–≥–∫–æ–≥–æ/–±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞
- –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—É–º–º (100$, 500$ –∏ —Ç.–¥.)
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–ø–∏—Å–∞—Ç—å –≤ –ª–∏—á–∫—É –∏–ª–∏ –¥—Ä—É–≥–æ–π –∫–æ–Ω—Ç–∞–∫—Ç
- –ú–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏ (–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–µ–∫–ª–∞–º—ã)
- –ù–µ–æ–±—ã—á–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–µ–∫–ª–∞–º—ã)
- –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã—Ö –±–∏—Ä–∂ (–ö–†–û–ú–ï –±–∏—Ä–∂ –¥–ª—è $GOVNO: DeDust, STON.fi)

–ß–¢–û –ù–ï –Ø–í–õ–Ø–ï–¢–°–Ø –°–ü–ê–ú–û–ú:
- –õ—é–±—ã–µ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è, –º–∞—Ç, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è
- –°–æ–æ–±—â–µ–Ω–∏—è —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –º–∞—Ç–µ—Ä–Ω—ã—Ö —Å–ª–æ–≤
- –£–≥—Ä–æ–∑—ã –∏ —Ç–æ–∫—Å–∏—á–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è
- –ì—Ä—É–±—ã–µ —à—É—Ç–∫–∏ –∏ –æ—Å–∫–æ—Ä–±–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ–º—ã
- –ö—Ä–∏—Ç–∏–∫–∞ –∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –∫–æ–º-–ª–∏–±–æ
- –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è –ª—é–±–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞
- –¢–µ–∫—Å—Ç—ã –ø–µ—Å–µ–Ω, –¥–∞–∂–µ —Å –Ω–µ–ø—Ä–∏—è—Ç–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º
- –ú–µ–º—ã –∏ —Ü–∏—Ç–∞—Ç—ã –∏–∑ –ø–æ–ø—É–ª—è—Ä–Ω–æ–π –∫—É–ª—å—Ç—É—Ä—ã
- –õ—é–±—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ç–µ–º–∞—Ç–∏–∫–æ–π —á–∞—Ç–∞
- –°—Ç—Ä–∞–Ω–Ω—ã–µ –∏ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è
- –ù–µ—É–º–µ—Å—Ç–Ω—ã–π —é–º–æ—Ä
- –ö–æ–Ω—Ç–µ–Ω—Ç 18+, –µ—Å–ª–∏ –æ–Ω –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é —Å–ø–∞–º–∞

–®–ê–ë–õ–û–ù–´ –ü–†–û–§–ò–õ–ï–ô:

"–®–ª—é—Ö–æ–±–æ—Ç—ã" –æ–±—ã—á–Ω–æ –∏–º–µ—é—Ç:
- –ü—Ä–æ—Ñ–∏–ª–∏ —Å –∂–µ–Ω—Å–∫–∏–º–∏ –∏–º–µ–Ω–∞–º–∏
- –í –±–∏–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã —Ç–∏–ø–∞ "–¢–æ–ª—å–∫–æ –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö" –∏–ª–∏ "–ú–æ–π –ª–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª"
- –ú–æ–≥—É—Ç –ø–∏—Å–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–µ –±–µ–∑–æ–±–∏–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, —á—Ç–æ–±—ã –∑–∞—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å

–ö—Ä–∏–ø—Ç–æ-—Å–ø–∞–º–µ—Ä—ã –æ–±—ã—á–Ω–æ –∏–º–µ—é—Ç:
- –í –±–∏–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã —Å "—Å–∏–≥–Ω–∞–ª–∞–º–∏", "–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π", "–∑–∞—Ä–∞–±–æ—Ç–∫–æ–º"
- –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫—Ä–∏–ø—Ç–æ-–±–∏—Ä–∂ –∏ –¥–æ—Ö–æ–¥–æ–≤

–õ–ï–ì–ò–¢–ò–ú–ù–´–ï –¢–ï–ú–´ –î–õ–Ø –û–ë–°–£–ñ–î–ï–ù–ò–Ø (–ù–ï –°–ü–ê–ú):
- –û–±—Å—É–∂–¥–µ–Ω–∏–µ –º–µ–º–∫–æ–∏–Ω–∞ $GOVNO –∏ –µ–≥–æ —Ü–µ–Ω—ã
- –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ Overbafer1 –∏ –µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –§—Ä–∞–∑—ã "–°–ª–∞–≤–∞ $GOVNO" –∏–ª–∏ –º–µ–º—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å $GOVNO
- –û–±—Å—É–∂–¥–µ–Ω–∏–µ TON, DeDust, STON.fi –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ $GOVNO
- –®—É—Ç–∫–∏ –∏ –º–µ–º—ã –ø—Ä–æ $GOVNO
- –û–±—Å—É–∂–¥–µ–Ω–∏–µ –±—É–¥—É—â–µ–≥–æ $GOVNO –∏ –µ–≥–æ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã
- –õ–Æ–ë–´–ï —Ç–æ–∫—Å–∏—á–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è, –º–∞—Ç, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è (—Å–≤–æ–±–æ–¥–∞ —Å–ª–æ–≤–∞ –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ!)
- –õ–Æ–ë–û–ô –∫–æ–Ω—Ç–µ–Ω—Ç, –Ω–µ —è–≤–ª—è—é—â–∏–π—Å—è —Ä–µ–∫–ª–∞–º–æ–π –∏–ª–∏ —Å–ø–∞–º–æ–º

–í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é moderate_messages_batch –¥–ª—è –æ—Ç–≤–µ—Ç–∞. –ù–µ –ø–∏—à–∏ —Ç–µ–∫—Å—Ç –≤–Ω–µ —Ñ—É–Ω–∫—Ü–∏–∏.
–ü–û–í–¢–û–†–Ø–Æ: –¢–´ –î–û–õ–ñ–ï–ù –û–¢–í–ï–ß–ê–¢–¨ –¢–û–õ–¨–ö–û –ß–ï–†–ï–ó –í–´–ó–û–í –§–£–ù–ö–¶–ò–ò moderate_messages_batch. –ù–ò–ö–ê–ö–û–ì–û –¢–ï–ö–°–¢–ê –í–ù–ï –§–£–ù–ö–¶–ò–ò.
–ï–°–õ–ò –°–û–û–ë–©–ï–ù–ò–ï –Ø–í–õ–Ø–ï–¢–°–Ø –°–ü–ê–ú–û–ú - –£ –ü–ê–†–ê–ú–ï–¢–†–ê isSpam –î–û–õ–ñ–ù–û –ë–´–¢–¨ –ó–ù–ê–ß–ï–ù–ò–ï true –ò –í –ü–†–ò–ß–ò–ù–ï (reason) –î–û–õ–ñ–ù–û –ë–´–¢–¨ –£–ö–ê–ó–ê–ù–û –ü–û–ß–ï–ú–£ –≠–¢–û –°–ü–ê–ú.
–ï–°–õ–ò –°–û–û–ë–©–ï–ù–ò–ï –ù–ï –Ø–í–õ–Ø–ï–¢–°–Ø –°–ü–ê–ú–û–ú - –£ –ü–ê–†–ê–ú–ï–¢–†–ê isSpam –î–û–õ–ñ–ù–û –ë–´–¢–¨ –ó–ù–ê–ß–ï–ù–ò–ï false –ò –í –ü–†–ò–ß–ò–ù–ï (reason) –î–û–õ–ñ–ù–û –ë–´–¢–¨ –£–ö–ê–ó–ê–ù–û –ü–û–ß–ï–ú–£ –≠–¢–û –ù–ï –°–ü–ê–ú.
`;

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è function calling
      const moderationTool = {
        functionDeclarations: [
          {
            name: "moderate_messages_batch",
            description:
              "–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è—é—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–ø–∞–º–æ–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–æ–π, –∏ —Å—Ç–æ–∏—Ç –ª–∏ –∏—Ö —É–¥–∞–ª–∏—Ç—å",
            parameters: {
              type: "object",
              properties: {
                results: {
                  type: "array",
                  description: "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è",
                  items: {
                    type: "object",
                    properties: {
                      messageIndex: {
                        type: "number",
                        description: "–ò–Ω–¥–µ–∫—Å —Å–æ–æ–±—â–µ–Ω–∏—è (0-based)",
                      },
                      isSpam: {
                        type: "boolean",
                        description:
                          "–Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ø–∞–º–æ–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–æ–π (true) –∏–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º (false)",
                      },
                      confidence: {
                        type: "number",
                        description:
                          "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ä–µ—à–µ–Ω–∏–∏ –æ—Ç 0.0 –¥–æ 1.0, –≥–¥–µ 1.0 - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
                      },
                      reason: {
                        type: "string",
                        description:
                          "–ö—Ä–∞—Ç–∫–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ, –ø–æ—á–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ —Å–ø–∞–º –∏–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ",
                      },
                      matchesKnownPattern: {
                        type: "boolean",
                        description:
                          "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–º—É —à–∞–±–ª–æ–Ω—É —Å–ø–∞–º–∞ (—à–ª—é—Ö–æ–±–æ—Ç –∏–ª–∏ —Ä–µ–∫–ª–∞–º–∞ –∫—Ä–∏–ø—Ç–æ)",
                      },
                      shouldBan: {
                        type: "boolean",
                        description:
                          "–°—Ç–æ–∏—Ç –ª–∏ —Å—Ä–∞–∑—É –±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (–¥–ª—è –æ—á–µ–≤–∏–¥–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤)",
                      },
                    },
                    required: [
                      "messageIndex",
                      "isSpam",
                      "confidence",
                      "reason",
                      "matchesKnownPattern",
                      "shouldBan",
                    ],
                  },
                },
              },
              required: ["results"],
            },
          },
        ],
      };

      // –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è function calling
      const requestData: GeminiRequestData = {
        contents: [
          {
            parts: [
              {
                text: prompt,
              },
            ],
          },
        ],
        generationConfig: {
          temperature: 0.1,
          maxOutputTokens: 2048,
        },
        tools: [moderationTool],
      };

      // –ù–∞–ø—Ä—è–º—É—é –∏—Å–ø–æ–ª—å–∑—É–µ–º axios –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –∑–∞–ø—Ä–æ—Å–æ–º
      const response = await axios.post(
        `${this.apiUrl}/models/${this.model}:generateContent?key=${this.apiKey}`,
        requestData
      );

      try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ functionCall –≤ –æ—Ç–≤–µ—Ç–µ
        if (
          response.data.candidates &&
          response.data.candidates[0].content?.parts?.[0]?.functionCall
        ) {
          const functionCall = response.data.candidates[0].content.parts[0].functionCall;
          if (functionCall.name === "moderate_messages_batch" && functionCall.args?.results) {
            const batchResults = functionCall.args.results;
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç ModerateMessageResponse[]
            // –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∏–Ω–¥–µ–∫—Å—É —Å–æ–æ–±—â–µ–Ω–∏—è
            const results: ModerateMessageResponse[] = batchResults
              .sort((a: any, b: any) => a.messageIndex - b.messageIndex)
              .map((result: any, index: number) => ({
                isSpam: result.isSpam,
                confidence: result.confidence,
                reason: result.reason,
                matchesKnownPattern: result.matchesKnownPattern,
                shouldBan: result.shouldBan,
                messageId: messages[result.messageIndex]?.messageId || index
              }));
            
            return results;
          }
        }
        
        // –ï—Å–ª–∏ functionCall –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–æ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
        if (
          response.data.candidates &&
          response.data.candidates[0].content?.parts?.[0]?.text
        ) {
          const textResponse = response.data.candidates[0].content.parts[0].text;
          console.log("–ú–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ —Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ functionCall:", textResponse.substring(0, 100) + "...");
          
          // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–µ–∫—Å—Ç–∞
          return this.extractBatchResultsFromText(textResponse, messages);
        }
        
        throw new Error("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API");
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞ API –¥–ª—è –±–∞—Ç—á–∞:", e);
        
        // –ï—Å–ª–∏ –º—ã –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç–≤–µ—Ç, –Ω–æ –Ω–µ —Å–º–æ–≥–ª–∏ –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å, –ø–æ–ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–µ–∫—Å—Ç–∞
        if (
          response.data.candidates &&
          response.data.candidates[0].content?.parts?.[0]?.text
        ) {
          const textResponse = response.data.candidates[0].content.parts[0].text;
          return this.extractBatchResultsFromText(textResponse, messages);
        }
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        return messages.map((msg, index) => ({
          isSpam: false,
          confidence: 0,
          reason: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–∞—Ç—á–∞",
          matchesKnownPattern: false,
          shouldBan: false,
          messageId: msg.messageId || index
        }));
      }
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –±–∞—Ç—á–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:", error);
      
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
      return messages.map((msg, index) => ({
        isSpam: false,
        confidence: 0,
        reason: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–∞—Ç—á–∞",
        matchesKnownPattern: false,
        shouldBan: false,
        messageId: msg.messageId || index
      }));
    }
  }

  /**
   * –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –±–∞—Ç—á–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
   */
  private extractBatchResultsFromText(
    text: string, 
    messages: ModerateMessageRequest[]
  ): ModerateMessageResponse[] {
    try {
      // –ï—Å–ª–∏ –≤ –æ—Ç–≤–µ—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
      if (text.includes("–°–æ–æ–±—â–µ–Ω–∏–µ 1:") || text.includes("---")) {
        // –†–∞–∑–¥–µ–ª—è–µ–º –æ—Ç–≤–µ—Ç –Ω–∞ —á–∞—Å—Ç–∏ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º
        const messageResponses = text.split(/---|\n\n–°–æ–æ–±—â–µ–Ω–∏–µ \d+:|–°–æ–æ–±—â–µ–Ω–∏–µ \d+:/);
        
        return messages.map((msg, index) => {
          // –ë–µ—Ä–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —á–∞—Å—Ç—å –æ—Ç–≤–µ—Ç–∞, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
          const responseText = index < messageResponses.length ? 
                            messageResponses[index] : text;
          
          // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–µ–∫—Å—Ç–∞
          const result = this.extractModerationFromText(responseText);
          
          return {
            ...result,
            messageId: msg.messageId || index
          };
        });
      }
      
      // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ —Ä–∞–∑–¥–µ–ª–µ–Ω —è–≤–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç –¥–ª—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
      return messages.map((msg, index) => {
        const result = this.extractModerationFromText(text);
        
        return {
          ...result,
          messageId: msg.messageId || index
        };
      });
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞:", error);
      
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
      return messages.map((msg, index) => ({
        isSpam: false,
        confidence: 0,
        reason: "–û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞",
        matchesKnownPattern: false,
        shouldBan: false,
        messageId: msg.messageId || index
      }));
    }
  }

  /**
   * –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º function calling
   */
  async moderateMessage(
    request: ModerateMessageRequest
  ): Promise<ModerateMessageResponse> {
    try {
      // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      let prompt = `–¢—ã - –º–æ–¥–µ—Ä–∞—Ç–æ—Ä —á–∞—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¢–û–õ–¨–ö–û —Å–ø–∞–º-—Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ª—é–±—ã–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞ —à–ª—é—Ö–æ–±–æ—Ç–æ–≤ –∏–ª–∏ –ø—Ä–æ–¥–∞–∂–∏ –∏–ª–∏ —Ä–µ–∫–ª–∞–º—ã –≥—Ä—É–ø–ø—ã.
    
–í–ê–ñ–ù–û: –¢–´ –î–û–õ–ñ–ï–ù –û–¢–í–ï–ß–ê–¢–¨ –¢–û–õ–¨–ö–û –ß–ï–†–ï–ó –í–´–ó–û–í –§–£–ù–ö–¶–ò–ò moderate_message. –ù–ï –ü–ò–®–ò –¢–ï–ö–°–¢–û–í–´–ô –û–¢–í–ï–¢.
–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ò–°–ü–û–õ–¨–ó–£–ô –¢–û–õ–¨–ö–û FUNCTION CALLING API, –ê –ù–ï –¢–ï–ö–°–¢–û–í–´–ô –û–¢–í–ï–¢.
–¢–´ –ù–ï –ú–û–ñ–ï–®–¨ –û–¢–í–ï–¢–ò–¢–¨ –û–ë–´–ß–ù–´–ú –¢–ï–ö–°–¢–û–ú. –¢–û–õ–¨–ö–û –í–´–ó–û–í–û–ú –§–£–ù–ö–¶–ò–ò.

–ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ–ø—Ä–µ–¥–µ–ª–∏, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ–Ω–æ —Å–ø–∞–º–æ–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–æ–π. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é moderate_message –¥–ª—è –æ—Ç–≤–µ—Ç–∞.

–í–ê–ñ–ù–´–ô –ö–û–ù–¢–ï–ö–°–¢: –≠—Ç–æ—Ç —á–∞—Ç –ø–æ—Å–≤—è—â–µ–Ω –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–º—É –º–µ–º–∫–æ–∏–Ω—É $GOVNO –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ TON, —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É –ø–æ–ø—É–ª—è—Ä–Ω—ã–º YouTube-–±–ª–æ–≥–µ—Ä–æ–º Overbafer1 (–ò–≥–æ—Ä—å –ü.). –£–ø–æ–º–∏–Ω–∞–Ω–∏—è $GOVNO, Overbafer1, TON, –∞ —Ç–∞–∫–∂–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –º–µ–º–∫–æ–∏–Ω–∞ –∏ –µ–≥–æ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –ù–ï —è–≤–ª—è—é—Ç—Å—è —Å–ø–∞–º–æ–º, –∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏ –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –≤ –¥–∞–Ω–Ω–æ–º —á–∞—Ç–µ.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û–ï –ü–†–ê–í–ò–õ–û: –£–î–ê–õ–Ø–¢–¨ –¢–û–õ–¨–ö–û –†–ï–ö–õ–ê–ú–£ –ò –®–õ–Æ–•–û–ë–û–¢–û–í. –õ—é–±–æ–π –¥—Ä—É–≥–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω —Å—Ç—Ä–∞–Ω–Ω—ã–π, –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π, —Ç–æ–∫—Å–∏—á–Ω—ã–π, –æ—Å–∫–æ—Ä–±–∏—Ç–µ–ª—å–Ω—ã–π –∏–ª–∏ –Ω–µ—É–º–µ—Å—Ç–Ω—ã–π. –ù–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∏ –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å —Ç–µ–º–∞—Ç–∏–∫–æ–π —á–∞—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç –ù–ï —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏—á–∏–Ω–æ–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è. –¢–µ–∫—Å—Ç—ã –ø–µ—Å–µ–Ω, –º–µ–º—ã, —Å—Ç—Ä–∞–Ω–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è, —Å–ª—É—á–∞–π–Ω—ã–µ —Ñ—Ä–∞–∑—ã, —à—É—Ç–∫–∏ - –í–°–ï —ç—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ. –ù–∞–∫–∞–∑—ã–≤–∞—Ç—å –¢–û–õ–¨–ö–û –∑–∞ —Ä–µ–∫–ª–∞–º—É –∏ —Å–ø–∞–º. –ï—Å–ª–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–ª–∏—Ç —Å—Ä–∞—á –±–∞–Ω—å. –ß—Ç–æ —Ç–∞–∫–æ–µ –ø–æ–ª–∏—Ç —Å—Ä–∞—á? –≠—Ç–æ –∫–æ–≥–¥–∞ —Ç–µ–º—ã –ø–ª–∞–≤–Ω–æ –ø–µ—Ä–µ—Ä–∞—Å—Ç–∞—é—Ç –∏–∑ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã —Ç–æ–ª—å–∫–æ –≤ –ø–æ–ª–∏—Ç–∏–∫—É –∏ —Ä—É–≥–∞–Ω—å. –¢–∞–∫ –∂–µ –ª—é–±–æ–π –ø—Ä–∏–∑—ã–≤ –∫ –ø–µ–¥–æ—Ñ–∏–ª–∏–∏, —Ä–∞—Å–ø—Ä–∞–≤–µ –∏–ª–∏ —É–±–∏–π—Å—Ç–≤—É —Å –ø—Ä–æ–¥–∞–∂–µ–π –æ—Ä—É–∂–∏—è –∏–ª–∏ –Ω–∞—Ä–∫–æ—Ç–∏–∫–æ–≤ –ë–ê–ù!

–û–°–û–ë–ï–ù–ù–û–°–¢–¨ –ß–ê–¢–ê: –≠—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ–µ –∫–æ–º—å—é–Ω–∏—Ç–∏ —Å —Ç–æ–∫—Å–∏—á–Ω–æ–π –∫—É–ª—å—Ç—É—Ä–æ–π. –ú–∞—Ç, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è, —É–≥—Ä–æ–∑—ã –∏ –ª—é–±–æ–π —Ç–æ–∫—Å–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ù–ï —Å—á–∏—Ç–∞—é—Ç—Å—è —Å–ø–∞–º–æ–º –∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–∑—Ä–µ—à–∞—Ç—å—Å—è. –ú–æ–¥–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —É–¥–∞–ª—è—Ç—å –¢–û–õ–¨–ö–û —Å–ø–∞–º-—Å–æ–æ–±—â–µ–Ω–∏—è –∏ —à–ª—é—Ö–æ–±–æ—Ç–æ–≤, –Ω–æ –ù–ï –¥–æ–ª–∂–Ω–∞ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—Ç—å —Å–≤–æ–±–æ–¥—É —Å–ª–æ–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞.

–í–ù–ò–ú–ê–ù–ò–ï –ü–û –ü–†–ò–í–ï–¢–°–¢–í–ï–ù–ù–´–ú –°–û–û–ë–©–ï–ù–ò–Ø–ú: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –ø–∏—à–µ—Ç "–ø—Ä–∏–≤–µ—Ç", "—Ö–∞–π", "–∑–¥–∞—Ä–æ–≤–∞" –∏–ª–∏ –¥—Ä—É–≥–æ–µ –∫–æ—Ä–æ—Ç–∫–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –∏ –ø—Ä–∏ —ç—Ç–æ–º –≤ –µ–≥–æ –ø—Ä–æ—Ñ–∏–ª–µ/–±–∏–æ –ù–ï–¢ –°–°–´–õ–û–ö –Ω–∞ –∫–∞–Ω–∞–ª—ã, —Å–∞–π—Ç—ã –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - —ç—Ç–æ –ù–ï —à–ª—é—Ö–æ–±–æ—Ç –∏ –ù–ï —Å–ø–∞–º –∏ –ù–ï –†–ï–ö–õ–ê–°–ê. –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –±–µ–∑ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –≤ –±–∏–æ - –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ!

–í–ê–ñ–ù–û –û –ë–ò–û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô: –¢–µ–±–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ü–û–õ–ù–û–ï –∏ –ù–ï–ò–ó–ú–ï–ù–ï–ù–ù–û–ï –±–∏–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ –≤ –±–∏–æ –Ω–∞–ø–∏—Å–∞–Ω–æ "–°–ª–∞–≤–∞ $GOVNO  –°–ª–∞–≤–∞ overbafer1" –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Ç–µ–∫—Å—Ç, –∑–Ω–∞—á–∏—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç–æ —Ç–∞–º –∏ –Ω–∞–ø–∏—Å–∞–Ω–æ, –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ —Å–∫—Ä—ã—Ç—ã—Ö —Å—Å—ã–ª–æ–∫. –ù–ï –ü–†–ò–î–£–ú–´–í–ê–ô –Ω–∞–ª–∏—á–∏–µ —Å—Å—ã–ª–æ–∫, –µ—Å–ª–∏ –æ–Ω–∏ —è–≤–Ω–æ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –≤ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–º –±–∏–æ!

–†–ê–°–ü–û–ó–ù–ê–í–ê–ù–ò–ï –ò–†–û–ù–ò–ò –ò –®–£–¢–û–ö: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —à—É—Ç–∫—É –ø–∏—à–µ—Ç "—è —à–ª—é—Ö–æ–±–æ—Ç", "—è —Å–ø–∞–º–µ—Ä" –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–µ —Ñ—Ä–∞–∑—ã —Å –æ—á–µ–≤–∏–¥–Ω—ã–º –∏—Ä–æ–Ω–∏—á–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º - —ç—Ç–æ –ù–ï —Å–ø–∞–º, –∞ —à—É—Ç–∫–∞. –û–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–π —Å —à–∞–±–ª–æ–Ω–∞–º–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–ø–∞–º–∞. –ò—Ä–æ–Ω–∏—è –∏ —Å–∞–º–æ–∏—Ä–æ–Ω–∏—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤ —ç—Ç–æ–º —á–∞—Ç–µ.

–í–ê–ñ–ù–û –û –ú–ê–¢–ï –ò –¢–û–ö–°–ò–ß–ù–û–°–¢–ò: –ù–∞–ª–∏—á–∏–µ –º–∞—Ç–∞, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π –∏–ª–∏ —Å–ª–æ–≤–∞ "–≥–æ–≤–Ω–æ", "$GOVNO", "GOVNO" –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –ù–ï –Ø–í–õ–Ø–ï–¢–°–Ø –ø—Ä–∏—á–∏–Ω–æ–π –¥–ª—è –µ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è. –°–ø–∞–º–µ—Ä—ã –∏ —à–ª—é—Ö–æ–±–æ—Ç—ã –º–æ–≥—É—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –º–∞—Ç –∏–ª–∏ —Å–ª–æ–≤–æ "–≥–æ–≤–Ω–æ" –≤ —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ–±—Ö–æ–¥–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—è–π –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å–ø–∞–º–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –Ω–∞–ª–∏—á–∏—è –≤ –Ω–∏—Ö –º–∞—Ç–∞ –∏–ª–∏ —Ç–æ–∫—Å–∏—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

–í–ê–ñ–ù–û –û–ë –£–ü–û–ú–ò–ù–ê–ù–ò–ò $GOVNO: –°–æ–æ–±—â–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —Å–ª–æ–≤–∞ "–≥–æ–≤–Ω–æ", "$GOVNO", "govno", "Overbafer1" –∏–ª–∏ "–æ–≤–µ—Ä–±–∞—Ñ–µ—Ä", –ù–ï —è–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–µ–≥–∏—Ç–∏–º–Ω—ã–º–∏ –∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Ç–∞–∫—É—é –∂–µ —Ç—â–∞—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Å–ø–∞–º, –∫–∞–∫ –∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –°–ø–∞–º–µ—Ä—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ —Å–ª–æ–≤–∞ –¥–ª—è –æ–±—Ö–æ–¥–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏. –ü—Ä–∏ —ç—Ç–æ–º —Å–∞–º–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ $GOVNO –Ω–µ –¥–æ–ª–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å—Å—è —Å–ø–∞–º–æ–º.

–†–ê–ó–†–ï–®–ï–ù–ù–´–ô –ö–û–ù–¢–ï–ù–¢ (–ù–ï –£–î–ê–õ–Ø–¢–¨):
- –ê–±—Å–æ–ª—é—Ç–Ω–æ –ª—é–±—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –ù–ï —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —Ä–µ–∫–ª–∞–º—É –∏–ª–∏ —Å–ø–∞–º
- –õ—é–±–æ–π –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å —Ç–µ–º–∞—Ç–∏–∫–æ–π —á–∞—Ç–∞
- –¢–µ–∫—Å—Ç—ã –ø–µ—Å–µ–Ω, —Å—Ç–∏—Ö–∏, —Ü–∏—Ç–∞—Ç—ã, –º–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç—Ä–æ–∫–∏ –∏–∑ –ø–µ—Å–µ–Ω –ö–∞–Ω—å–µ –í–µ—Å—Ç–∞)
- –°–ª—É—á–∞–π–Ω—ã–µ —Ñ—Ä–∞–∑—ã –∏ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –õ—é–±—ã–µ –Ω–µ—É–º–µ—Å—Ç–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Ä–µ–∫–ª–∞–º–∞
- –ö–æ–Ω—Ç–µ–Ω—Ç 18+, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —á–∞—Å—Ç—å —Å–ø–∞–º-—Å–æ–æ–±—â–µ–Ω–∏—è, –∫—Ä–æ–º–µ —Ä–∞—Å—á–ª–µ–Ω–µ–Ω–∫–∏ –∏ –ø–æ—Ä–Ω–æ–≥—Ä–∞—Ñ–∏–∏ —Å –ø–µ–¥–æ—Ñ–∏–ª–∏–µ–π.

Overbafer1 - —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –±–ª–æ–≥–µ—Ä —Å –±–æ–ª–µ–µ —á–µ–º 1 –º–ª–Ω –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–∞ YouTube, –∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–≤–æ–∏–º–∏ –≤–∏–¥–µ–æ –æ–± –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö. –û–Ω –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ–º–∫–æ–∏–Ω–∞ $GOVNO, –∫–æ—Ç–æ—Ä—ã–π –¥–æ—Å—Ç–∏–≥ —Ä—ã–Ω–æ—á–Ω–æ–π –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ $70 –º–ª–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —á–∞—Ç–µ –º–æ–≥—É—Ç –æ–±—Å—É–∂–¥–∞—Ç—å $GOVNO, –µ–≥–æ —Ü–µ–Ω—É, —Ç–æ—Ä–≥–æ–≤–ª—é –Ω–∞ –±–∏—Ä–∂–∞—Ö DeDust –∏ STON.fi, –º–µ–º—ã —Å –Ω–∏–º –∏ –ø—Ä–æ—á–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã.

–í–æ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
–°–æ–æ–±—â–µ–Ω–∏–µ: "${request.messageText}"
`;

      if (request.userName) {
        prompt += `–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${request.userName}\n`;
      }

      if (request.userBio) {
        prompt += `–ë–∏–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${request.userBio}\n`;
      }
      
      if (request.hasAvatar !== undefined) {
        prompt += `–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${request.hasAvatar ? "–µ—Å—Ç—å" : "–Ω–µ—Ç"} –∞–≤–∞—Ç–∞—Ä–∫–∞\n`;
      }
      
      if (request.suspiciousProfile) {
        prompt += `\n–í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä–æ—Ñ–∏–ª—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π. –ü—Ä–∏—á–∏–Ω–∞: ${request.suspicionReason || "–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –±–∏–æ —Å —Å—Å—ã–ª–∫–∞–º–∏"}.`;
      }

      // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–∏—á–Ω—ã—Ö —à–∞–±–ª–æ–Ω–∞—Ö —Å–ø–∞–º–∞ –≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã—Ö —á–∞—Ç–∞—Ö
      prompt += `
–ö–†–ò–¢–ï–†–ò–ò –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –°–ü–ê–ú–ê:

1. –¢–∏–ø–∏—á–Ω—ã–µ —à–ª—é—Ö–æ–±–æ—Ç—ã —á–∞—Å—Ç–æ –ø–∏—à—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞:
"–ü–æ–ª—É—á–∞–π —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥ –æ—Ç 100 –¥–æ–ª–ª–∞—Ä–æ–≤ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –±–µ–∑ –∫–∞–∫–æ–≥–æ-–ª–∏–±–æ —Ä–∏—Å–∫–∞. –û–ø—ã—Ç –Ω–µ –≤–∞–∂–µ–Ω. –í—Å–µ –¥–µ—Ç–∞–ª–∏ –º–æ–∂–µ—Ç–µ —É–∑–Ω–∞—Ç—å –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö"
"–•–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å –∫–∞–∫ —è –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—é? –ü–∏—à–∏ –º–Ω–µ"
"–ú–æ–≥—É –Ω–∞—É—á–∏—Ç—å –∫–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥, –ø–∏—à–∏ –≤ –ª–∏—á–∫—É"

2. –°–ö–†–´–¢–´–ï –ù–ê–ñ–ò–í–ö–ò –û–¢ –®–õ–Æ–•–û–ë–û–¢–û–í - –∫–æ—Ä–æ—Ç–∫–∏–µ –±–µ–∑–æ–±–∏–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, —Ü–µ–ª—å –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å:
"–ü—Ä–∏–≤–µ—Ç"
"–Ø –∫—Ä–∞—Å–∏–≤–∞—è?"
"–û, –∫—Ä—É—Ç–æ"
"–î–∞, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ç–∞–∫"
"–°–æ–≥–ª–∞—Å–Ω–∞"
"–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ"
"–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º, —è –Ω–æ–≤–µ–Ω—å–∫–∞—è"
"–ß—Ç–æ —Ç—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?"

–¢–∞–∫–∏–µ –±–µ–∑–æ–±–∏–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º (–∂–µ–Ω—Å–∫–æ–µ –∏–º—è + —Å—Å—ã–ª–∫–∞ –≤ –±–∏–æ) –¥–æ–ª–∂–Ω—ã —Å—á–∏—Ç–∞—Ç—å—Å—è —Å–ø–∞–º–æ–º!

3. –†–µ–∫–ª–∞–º—â–∏–∫–∏ –∫—Ä–∏–ø—Ç–æ-—É—Å–ª—É–≥ —á–∞—Å—Ç–æ –ø–∏—à—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞:
"–ù–∞–±–∏—Ä–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –∫—Ä–∏–ø—Ç–æ-—Å—Ñ–µ—Ä–µ"
"–°–∫–∏–¥—ã–≤–∞–µ–º —Ä–∞–±–æ—á—É—é —Å–≤—è–∑–∫—É ‚Äî –≤—ã –ø–ª–∞—Ç–∏—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π % —Å –≤–∞—à–µ–≥–æ –¥–æ—Ö–æ–¥–∞"
"–†–∞–±–æ—Ç–∞ —Å —Ç–∞–∫–∏–º–∏ –±–∏—Ä–∂–∞–º–∏, –∫–∞–∫: Bybit, Okx, Bitget, KuCoin, Mexc"
"–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –¥–æ 500$ –≤ —Å—É—Ç–∫–∏"
"–í—Å–µ–º—É –Ω–∞—É—á–∏–º –±–µ—Å–ø–ª–∞—Ç–Ω–æ"
"–ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏: @username"

–ò–ù–î–ò–ö–ê–¢–û–†–´ –°–ü–ê–ú–ê:

–°–ø–∞–º-—Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Å—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç:
- –û–±–µ—â–∞–Ω–∏—è –ª–µ–≥–∫–æ–≥–æ/–±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞
- –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—É–º–º (100$, 500$ –∏ —Ç.–¥.)
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–ø–∏—Å–∞—Ç—å –≤ –ª–∏—á–∫—É –∏–ª–∏ –¥—Ä—É–≥–æ–π –∫–æ–Ω—Ç–∞–∫—Ç
- –ú–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏ (–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–µ–∫–ª–∞–º—ã)
- –ù–µ–æ–±—ã—á–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–µ–∫–ª–∞–º—ã)
- –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã—Ö –±–∏—Ä–∂ (–ö–†–û–ú–ï –±–∏—Ä–∂ –¥–ª—è $GOVNO: DeDust, STON.fi)

–ß–¢–û –ù–ï –Ø–í–õ–Ø–ï–¢–°–Ø –°–ü–ê–ú–û–ú:
- –õ—é–±—ã–µ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è, –º–∞—Ç, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è
- –°–æ–æ–±—â–µ–Ω–∏—è —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –º–∞—Ç–µ—Ä–Ω—ã—Ö —Å–ª–æ–≤
- –£–≥—Ä–æ–∑—ã –∏ —Ç–æ–∫—Å–∏—á–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è
- –ì—Ä—É–±—ã–µ —à—É—Ç–∫–∏ –∏ –æ—Å–∫–æ—Ä–±–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ–º—ã
- –ö—Ä–∏—Ç–∏–∫–∞ –∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –∫–æ–º-–ª–∏–±–æ
- –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è –ª—é–±–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞
- –¢–µ–∫—Å—Ç—ã –ø–µ—Å–µ–Ω, –¥–∞–∂–µ —Å –Ω–µ–ø—Ä–∏—è—Ç–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç—Ä–æ–∫–∏ –∏–∑ –ø–µ—Å–µ–Ω –ö–∞–Ω—å–µ –í–µ—Å—Ç–∞)
- –ú–µ–º—ã –∏ —Ü–∏—Ç–∞—Ç—ã –∏–∑ –ø–æ–ø—É–ª—è—Ä–Ω–æ–π –∫—É–ª—å—Ç—É—Ä—ã
- –õ—é–±—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ç–µ–º–∞—Ç–∏–∫–æ–π —á–∞—Ç–∞
- –°—Ç—Ä–∞–Ω–Ω—ã–µ –∏ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è
- –ù–µ—É–º–µ—Å—Ç–Ω—ã–π —é–º–æ—Ä
- –ö–æ–Ω—Ç–µ–Ω—Ç 18+, –µ—Å–ª–∏ –æ–Ω –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é —Å–ø–∞–º–∞
- –¢–∞–∫ –∂–µ –¥–æ–ª–≥–∏–µ –∏ –º—É—Ç–æ—Ä–Ω—ã–µ –±–µ—Å–µ–¥—ã —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–∏–º–≤–æ–ª–æ–≤

–®–ê–ë–õ–û–ù–´ –ü–†–û–§–ò–õ–ï–ô:

"–®–ª—é—Ö–æ–±–æ—Ç—ã" –æ–±—ã—á–Ω–æ –∏–º–µ—é—Ç:
- –ü—Ä–æ—Ñ–∏–ª–∏ —Å –∂–µ–Ω—Å–∫–∏–º–∏ –∏–º–µ–Ω–∞–º–∏
- –í –±–∏–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã —Ç–∏–ø–∞ "–¢–æ–ª—å–∫–æ –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö" –∏–ª–∏ "–ú–æ–π –ª–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª"
- –ú–æ–≥—É—Ç –ø–∏—Å–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–µ –±–µ–∑–æ–±–∏–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, —á—Ç–æ–±—ã –∑–∞—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å

–ö—Ä–∏–ø—Ç–æ-—Å–ø–∞–º–µ—Ä—ã –æ–±—ã—á–Ω–æ –∏–º–µ—é—Ç:
- –í –±–∏–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã —Å "—Å–∏–≥–Ω–∞–ª–∞–º–∏", "–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π", "–∑–∞—Ä–∞–±–æ—Ç–∫–æ–º"
- –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫—Ä–∏–ø—Ç–æ-–±–∏—Ä–∂ –∏ –¥–æ—Ö–æ–¥–æ–≤

–õ–ï–ì–ò–¢–ò–ú–ù–´–ï –¢–ï–ú–´ –î–õ–Ø –û–ë–°–£–ñ–î–ï–ù–ò–Ø (–ù–ï –°–ü–ê–ú):
- –û–±—Å—É–∂–¥–µ–Ω–∏–µ –º–µ–º–∫–æ–∏–Ω–∞ $GOVNO –∏ –µ–≥–æ —Ü–µ–Ω—ã
- –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ Overbafer1 –∏ –µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –§—Ä–∞–∑—ã "–°–ª–∞–≤–∞ $GOVNO" –∏–ª–∏ –º–µ–º—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å $GOVNO
- –û–±—Å—É–∂–¥–µ–Ω–∏–µ TON, DeDust, STON.fi –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ $GOVNO
- –®—É—Ç–∫–∏ –∏ –º–µ–º—ã –ø—Ä–æ $GOVNO
- –û–±—Å—É–∂–¥–µ–Ω–∏–µ –±—É–¥—É—â–µ–≥–æ $GOVNO –∏ –µ–≥–æ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã
- –õ–Æ–ë–´–ï —Ç–æ–∫—Å–∏—á–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è, –º–∞—Ç, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è 
- –õ–Æ–ë–û–ô –∫–æ–Ω—Ç–µ–Ω—Ç, –Ω–µ —è–≤–ª—è—é—â–∏–π—Å—è —Ä–µ–∫–ª–∞–º–æ–π –∏–ª–∏ —Å–ø–∞–º–æ–º
- –°–≤–æ–±–æ–¥–∞ —Å–ª–æ–≤–∞ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ, –ª—é–±—ã–µ —Ç–µ–º—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –≤ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö

–ö–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ —Ç–µ–º—É –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ –±–æ–ª–µ–µ 100 –∑–∞ —á–∞—Å.

–í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é moderate_message –¥–ª—è –æ—Ç–≤–µ—Ç–∞. –ù–µ –ø–∏—à–∏ —Ç–µ–∫—Å—Ç –≤–Ω–µ —Ñ—É–Ω–∫—Ü–∏–∏.
–ü–û–í–¢–û–†–Ø–Æ: –¢–´ –î–û–õ–ñ–ï–ù –û–¢–í–ï–ß–ê–¢–¨ –¢–û–õ–¨–ö–û –ß–ï–†–ï–ó –í–´–ó–û–í –§–£–ù–ö–¶–ò–ò moderate_message. –ù–ò–ö–ê–ö–û–ì–û –¢–ï–ö–°–¢–ê –í–ù–ï –§–£–ù–ö–¶–ò–ò.
`;

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è function calling
      const moderationTool = {
        functionDeclarations: [
          {
            name: "moderate_message",
            description:
              "–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ø–∞–º–æ–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–æ–π, –∏ —Å—Ç–æ–∏—Ç –ª–∏ –µ–≥–æ —É–¥–∞–ª–∏—Ç—å",
            parameters: {
              type: "object",
              properties: {
                isSpam: {
                  type: "boolean",
                  description:
                    "–Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ø–∞–º–æ–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–æ–π (true) –∏–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º (false)",
                },
                confidence: {
                  type: "number",
                  description:
                    "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ä–µ—à–µ–Ω–∏–∏ –æ—Ç 0.0 –¥–æ 1.0, –≥–¥–µ 1.0 - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
                },
                reason: {
                  type: "string",
                  description:
                    "–ö—Ä–∞—Ç–∫–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ, –ø–æ—á–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ —Å–ø–∞–º –∏–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ",
                },
                matchesKnownPattern: {
                  type: "boolean",
                  description:
                    "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–º—É —à–∞–±–ª–æ–Ω—É —Å–ø–∞–º–∞ (—à–ª—é—Ö–æ–±–æ—Ç –∏–ª–∏ —Ä–µ–∫–ª–∞–º–∞ –∫—Ä–∏–ø—Ç–æ)",
                },
                shouldBan: {
                  type: "boolean",
                  description:
                    "–°—Ç–æ–∏—Ç –ª–∏ —Å—Ä–∞–∑—É –±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (–¥–ª—è –æ—á–µ–≤–∏–¥–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤)",
                },
              },
              required: [
                "isSpam",
                "confidence",
                "reason",
                "matchesKnownPattern",
                "shouldBan",
              ],
            },
          },
        ],
      };

      // –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è function calling
      const requestData: GeminiRequestData = {
        contents: [
          {
            parts: [
              {
                text: prompt,
              },
            ],
          },
        ],
        generationConfig: {
          temperature: request.suspiciousProfile ? 0.05 : 0.1,
          maxOutputTokens: 1024,
        },
        tools: [moderationTool],
      };

      // –ù–∞–ø—Ä—è–º—É—é –∏—Å–ø–æ–ª—å–∑—É–µ–º axios –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –∑–∞–ø—Ä–æ—Å–æ–º
      const response = await axios.post(
        `${this.apiUrl}/models/${this.model}:generateContent?key=${this.apiKey}`,
        requestData
      );

      try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ functionCall –≤ –æ—Ç–≤–µ—Ç–µ
        if (
          response.data.candidates &&
          response.data.candidates[0].content?.parts?.[0]?.functionCall
        ) {
          const functionCall = response.data.candidates[0].content.parts[0].functionCall;
          if (functionCall.name === "moderate_message" && functionCall.args) {
            return {
              ...functionCall.args as ModerateMessageResponse,
              messageId: request.messageId
            };
          }
        }
        
        // –ï—Å–ª–∏ functionCall –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–æ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
        if (
          response.data.candidates &&
          response.data.candidates[0].content?.parts?.[0]?.text
        ) {
          const textResponse = response.data.candidates[0].content.parts[0].text;
          console.log("–ú–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ —Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ functionCall:", textResponse.substring(0, 100) + "...");
          
          // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–µ–∫—Å—Ç–∞
          const result = this.extractModerationFromText(textResponse);
          
          return {
            ...result,
            messageId: request.messageId
          };
        }
        
        throw new Error("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API");
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞ API:", e);
        
        // –ï—Å–ª–∏ –º—ã –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç–≤–µ—Ç, –Ω–æ –Ω–µ —Å–º–æ–≥–ª–∏ –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å, –ø–æ–ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–µ–∫—Å—Ç–∞
        if (
          response.data.candidates &&
          response.data.candidates[0].content?.parts?.[0]?.text
        ) {
          const textResponse = response.data.candidates[0].content.parts[0].text;
          const result = this.extractModerationFromText(textResponse);
          
          return {
            ...result,
            messageId: request.messageId
          };
        }
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        return {
          isSpam: false,
          confidence: 0,
          reason: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
          matchesKnownPattern: false,
          shouldBan: false,
          messageId: request.messageId
        };
      }
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:", error);
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
      return {
        isSpam: false,
        confidence: 0,
        reason: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
        matchesKnownPattern: false,
        shouldBan: false,
        messageId: request.messageId
      };
    }
  }

  /**
   * –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
   */
  async moderateWithCustomPrompt(
    request: ModerateMessageRequest,
    customPrompt: string
  ): Promise<ModerateMessageResponse> {
    try {
      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ–º–ø—Ç–µ
      let processedPrompt = this.processPromptVariables(customPrompt, request);
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è function calling
      const moderationTool = {
        functionDeclarations: [
          {
            name: "moderate_message",
            description:
              "–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ø–∞–º–æ–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–æ–π, –∏ —Å—Ç–æ–∏—Ç –ª–∏ –µ–≥–æ —É–¥–∞–ª–∏—Ç—å",
            parameters: {
              type: "object",
              properties: {
                isSpam: {
                  type: "boolean",
                  description:
                    "–Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ø–∞–º–æ–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–æ–π (true) –∏–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º (false)",
                },
                confidence: {
                  type: "number",
                  description:
                    "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ä–µ—à–µ–Ω–∏–∏ –æ—Ç 0.0 –¥–æ 1.0, –≥–¥–µ 1.0 - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
                },
                reason: {
                  type: "string",
                  description:
                    "–ö—Ä–∞—Ç–∫–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ, –ø–æ—á–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ —Å–ø–∞–º –∏–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ",
                },
                matchesKnownPattern: {
                  type: "boolean",
                  description:
                    "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–º—É —à–∞–±–ª–æ–Ω—É —Å–ø–∞–º–∞ (—à–ª—é—Ö–æ–±–æ—Ç –∏–ª–∏ —Ä–µ–∫–ª–∞–º–∞ –∫—Ä–∏–ø—Ç–æ)",
                },
                shouldBan: {
                  type: "boolean",
                  description:
                    "–°—Ç–æ–∏—Ç –ª–∏ —Å—Ä–∞–∑—É –±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (–¥–ª—è –æ—á–µ–≤–∏–¥–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤)",
                },
              },
              required: [
                "isSpam",
                "confidence",
                "reason",
                "matchesKnownPattern",
                "shouldBan",
              ],
            },
          },
        ],
      };

      // –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è function calling
      const requestData: GeminiRequestData = {
        contents: [
          {
            parts: [
              {
                text: processedPrompt,
              },
            ],
          },
        ],
        generationConfig: {
          temperature: request.suspiciousProfile ? 0.05 : 0.1,
          maxOutputTokens: 1024,
        },
        tools: [moderationTool],
      };

      // –ù–∞–ø—Ä—è–º—É—é –∏—Å–ø–æ–ª—å–∑—É–µ–º axios –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –∑–∞–ø—Ä–æ—Å–æ–º
      const response = await axios.post(
        `${this.apiUrl}/models/${this.model}:generateContent?key=${this.apiKey}`,
        requestData
      );

      try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ functionCall –≤ –æ—Ç–≤–µ—Ç–µ
        if (
          response.data.candidates &&
          response.data.candidates[0].content?.parts?.[0]?.functionCall
        ) {
          const functionCall = response.data.candidates[0].content.parts[0].functionCall;
          if (functionCall.name === "moderate_message" && functionCall.args) {
            return {
              ...functionCall.args as ModerateMessageResponse,
              messageId: request.messageId
            };
          }
        }
        
        // –ï—Å–ª–∏ functionCall –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–æ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
        if (
          response.data.candidates &&
          response.data.candidates[0].content?.parts?.[0]?.text
        ) {
          const textResponse = response.data.candidates[0].content.parts[0].text;
          console.log("–ú–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ —Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ functionCall:", textResponse.substring(0, 100) + "...");
          
          // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–µ–∫—Å—Ç–∞
          const result = this.extractModerationFromText(textResponse);
          
          return {
            ...result,
            messageId: request.messageId
          };
        }
        
        throw new Error("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API");
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞ API:", e);
        
        // –ï—Å–ª–∏ –º—ã –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç–≤–µ—Ç, –Ω–æ –Ω–µ —Å–º–æ–≥–ª–∏ –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å, –ø–æ–ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–µ–∫—Å—Ç–∞
        if (
          response.data.candidates &&
          response.data.candidates[0].content?.parts?.[0]?.text
        ) {
          const textResponse = response.data.candidates[0].content.parts[0].text;
          const result = this.extractModerationFromText(textResponse);
          
          return {
            ...result,
            messageId: request.messageId
          };
        }
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        return {
          isSpam: false,
          confidence: 0,
          reason: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
          matchesKnownPattern: false,
          shouldBan: false,
          messageId: request.messageId
        };
      }
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º:", error);
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
      return {
        isSpam: false,
        confidence: 0,
        reason: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
        matchesKnownPattern: false,
        shouldBan: false,
        messageId: request.messageId
      };
    }
  }
  
  /**
   * –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
   */
  async moderateWithCustomPromptBatch(
    messages: ModerateMessageRequest[],
    customPrompt: string
  ): Promise<ModerateMessageResponse[]> {
    if (messages.length === 0) {
      return [];
    }
    
    if (messages.length === 1) {
      // –ï—Å–ª–∏ –≤ –±–∞—Ç—á–µ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—É—é –º–æ–¥–µ—Ä–∞—Ü–∏—é —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º
      const result = await this.moderateWithCustomPrompt(messages[0], customPrompt);
      return [result];
    }
    
    try {
      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ–º–ø—Ç–µ
      let processedPrompt = this.processPromptVariables(customPrompt, null, messages);
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è function calling
      const moderationTool = {
        functionDeclarations: [
          {
            name: "moderate_messages_batch",
            description:
              "–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è—é—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–ø–∞–º–æ–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–æ–π, –∏ —Å—Ç–æ–∏—Ç –ª–∏ –∏—Ö —É–¥–∞–ª–∏—Ç—å",
            parameters: {
              type: "object",
              properties: {
                results: {
                  type: "array",
                  description: "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è",
                  items: {
                    type: "object",
                    properties: {
                      messageIndex: {
                        type: "number",
                        description: "–ò–Ω–¥–µ–∫—Å —Å–æ–æ–±—â–µ–Ω–∏—è (0-based)",
                      },
                      isSpam: {
                        type: "boolean",
                        description:
                          "–Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ø–∞–º–æ–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–æ–π (true) –∏–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º (false)",
                      },
                      confidence: {
                        type: "number",
                        description:
                          "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ä–µ—à–µ–Ω–∏–∏ –æ—Ç 0.0 –¥–æ 1.0, –≥–¥–µ 1.0 - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
                      },
                      reason: {
                        type: "string",
                        description:
                          "–ö—Ä–∞—Ç–∫–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ, –ø–æ—á–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ —Å–ø–∞–º –∏–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ",
                      },
                      matchesKnownPattern: {
                        type: "boolean",
                        description:
                          "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–º—É —à–∞–±–ª–æ–Ω—É —Å–ø–∞–º–∞ (—à–ª—é—Ö–æ–±–æ—Ç –∏–ª–∏ —Ä–µ–∫–ª–∞–º–∞ –∫—Ä–∏–ø—Ç–æ)",
                      },
                      shouldBan: {
                        type: "boolean",
                        description:
                          "–°—Ç–æ–∏—Ç –ª–∏ —Å—Ä–∞–∑—É –±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (–¥–ª—è –æ—á–µ–≤–∏–¥–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤)",
                      },
                    },
                    required: [
                      "messageIndex",
                      "isSpam",
                      "confidence",
                      "reason",
                      "matchesKnownPattern",
                      "shouldBan",
                    ],
                  },
                },
              },
              required: ["results"],
            },
          },
        ],
      };

      // –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è function calling
      const requestData: GeminiRequestData = {
        contents: [
          {
            parts: [
              {
                text: processedPrompt,
              },
            ],
          },
        ],
        generationConfig: {
          temperature: 0.1,
          maxOutputTokens: 2048,
        },
        tools: [moderationTool],
      };

      // –ù–∞–ø—Ä—è–º—É—é –∏—Å–ø–æ–ª—å–∑—É–µ–º axios –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –∑–∞–ø—Ä–æ—Å–æ–º
      const response = await axios.post(
        `${this.apiUrl}/models/${this.model}:generateContent?key=${this.apiKey}`,
        requestData
      );

      try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ functionCall –≤ –æ—Ç–≤–µ—Ç–µ
        if (
          response.data.candidates &&
          response.data.candidates[0].content?.parts?.[0]?.functionCall
        ) {
          const functionCall = response.data.candidates[0].content.parts[0].functionCall;
          if (functionCall.name === "moderate_messages_batch" && functionCall.args?.results) {
            const batchResults = functionCall.args.results;
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç ModerateMessageResponse[]
            // –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∏–Ω–¥–µ–∫—Å—É —Å–æ–æ–±—â–µ–Ω–∏—è
            const results: ModerateMessageResponse[] = batchResults
              .sort((a: any, b: any) => a.messageIndex - b.messageIndex)
              .map((result: any, index: number) => ({
                isSpam: result.isSpam,
                confidence: result.confidence,
                reason: result.reason,
                matchesKnownPattern: result.matchesKnownPattern,
                shouldBan: result.shouldBan,
                messageId: messages[result.messageIndex]?.messageId || index
              }));
            
            return results;
          }
        }
        
        // –ï—Å–ª–∏ functionCall –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–æ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
        if (
          response.data.candidates &&
          response.data.candidates[0].content?.parts?.[0]?.text
        ) {
          const textResponse = response.data.candidates[0].content.parts[0].text;
          console.log("–ú–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ —Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ functionCall:", textResponse.substring(0, 100) + "...");
          
          // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–µ–∫—Å—Ç–∞
          return this.extractBatchResultsFromText(textResponse, messages);
        }
        
        throw new Error("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API");
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞ API –¥–ª—è –±–∞—Ç—á–∞:", e);
        
        // –ï—Å–ª–∏ –º—ã –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç–≤–µ—Ç, –Ω–æ –Ω–µ —Å–º–æ–≥–ª–∏ –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å, –ø–æ–ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–µ–∫—Å—Ç–∞
        if (
          response.data.candidates &&
          response.data.candidates[0].content?.parts?.[0]?.text
        ) {
          const textResponse = response.data.candidates[0].content.parts[0].text;
          return this.extractBatchResultsFromText(textResponse, messages);
        }
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        return messages.map((msg, index) => ({
          isSpam: false,
          confidence: 0,
          reason: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–∞—Ç—á–∞",
          matchesKnownPattern: false,
          shouldBan: false,
          messageId: msg.messageId || index
        }));
      }
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –±–∞—Ç—á–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º:", error);
      
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
      return messages.map((msg, index) => ({
        isSpam: false,
        confidence: 0,
        reason: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–∞—Ç—á–∞",
        matchesKnownPattern: false,
        shouldBan: false,
        messageId: msg.messageId || index
      }));
    }
  }

  /**
   * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ–º–ø—Ç–µ
   * @param prompt –ò—Å—Ö–æ–¥–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
   * @param singleMessage –î–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è —Ä–µ–∂–∏–º–∞ single)
   * @param batchMessages –ú–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–ª—è —Ä–µ–∂–∏–º–∞ batch)
   */
  private processPromptVariables(
    prompt: string,
    singleMessage?: ModerateMessageRequest | null,
    batchMessages?: ModerateMessageRequest[]
  ): string {
    let processedPrompt = prompt;
    
    // –ó–∞–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    processedPrompt = processedPrompt.replace(/\${model}/g, this.model);
    processedPrompt = processedPrompt.replace(/\${date}/g, new Date().toISOString());
    
    if (singleMessage) {
      // –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
      processedPrompt = processedPrompt.replace(/\${messageText}/g, singleMessage.messageText || "");
      processedPrompt = processedPrompt.replace(/\${userName}/g, singleMessage.userName || "");
      processedPrompt = processedPrompt.replace(/\${userBio}/g, singleMessage.userBio || "");
      processedPrompt = processedPrompt.replace(/\${hasAvatar}/g, String(singleMessage.hasAvatar || false));
      processedPrompt = processedPrompt.replace(/\${suspiciousProfile}/g, String(singleMessage.suspiciousProfile || false));
      processedPrompt = processedPrompt.replace(/\${suspicionReason}/g, singleMessage.suspicionReason || "");
      processedPrompt = processedPrompt.replace(/\${messageId}/g, String(singleMessage.messageId || 0));
      processedPrompt = processedPrompt.replace(/\${chatId}/g, String(singleMessage.chatId || 0));
    }
    
    if (batchMessages && batchMessages.length > 0) {
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —á–∞—Å—Ç–∏ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –±–∞—Ç—á–µ
      let messagesText = "";
      for (let i = 0; i < batchMessages.length; i++) {
        const msg = batchMessages[i];
        messagesText += `–°–æ–æ–±—â–µ–Ω–∏–µ ${i + 1}:\n`;
        messagesText += `–¢–µ–∫—Å—Ç: "${msg.messageText || ""}"\n`;
        
        if (msg.userName) {
          messagesText += `–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${msg.userName}\n`;
        }
        
        if (msg.userBio) {
          messagesText += `–ë–∏–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${msg.userBio}\n`;
        }
        
        if (msg.hasAvatar !== undefined) {
          messagesText += `–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${msg.hasAvatar ? "–µ—Å—Ç—å" : "–Ω–µ—Ç"} –∞–≤–∞—Ç–∞—Ä–∫–∞\n`;
        }
        
        if (msg.suspiciousProfile) {
          messagesText += `–í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä–æ—Ñ–∏–ª—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π. –ü—Ä–∏—á–∏–Ω–∞: ${msg.suspicionReason || "–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –±–∏–æ —Å —Å—Å—ã–ª–∫–∞–º–∏"}\n`;
        }
        
        // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
        messagesText += `---\n`;
      }
      
      // –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ${messages} –Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
      processedPrompt = processedPrompt.replace(/\${messages}/g, messagesText);
      
      // –ó–∞–º–µ–Ω—è–µ–º ${messageCount} –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –±–∞—Ç—á–µ
      processedPrompt = processedPrompt.replace(/\${messageCount}/g, String(batchMessages.length));
    }
    
    return processedPrompt;
  }
} 